{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\VarManager.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["import ManagerInterface from \"./ManagerInterface\";\r\nimport CommandParserInterface from \"./parsers/CommandParserInterface\";\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n/**\r\n * 管理游戏内变量数据\r\n */\r\n@ccclass\r\nexport default class VarManager extends ManagerInterface {\r\n\r\n    static instance : VarManager = null;\r\n\r\n    @property({\r\n        visible: false,\r\n    })\r\n    varMap = [];\r\n\r\n    onLoad(){\r\n        VarManager.instance = this;\r\n        this.setVar(\"Canvas\", cc.find(\"Canvas/DisplayArea\").getComponent(cc.Sprite));\r\n    }\r\n\r\n    start(){\r\n        \r\n    }\r\n\r\n    setVar(name: string, value): void{\r\n        if(!this.validVarName(name)){\r\n            return;\r\n        }\r\n        if(typeof(this.varMap[name]) != \"undefined\" && typeof(value) != typeof(this.varMap[name])){\r\n            cc.error(\"设置变量类型不匹配：\" + typeof(value) + \"，应为\" + typeof(this.varMap[name]));\r\n        }\r\n        this.varMap[name] = value;\r\n        cc.log(\"设置变量\" + name + \"为\" + value);\r\n    }\r\n\r\n    getVar(name: string){\r\n        if(!this.validVarName(name)){\r\n            return;\r\n        }\r\n        if(typeof(this.varMap[name]) == \"undefined\"){\r\n            cc.error(\"变量\" + name +\"未定义过\");\r\n        }\r\n        return this.varMap[name];\r\n    }\r\n\r\n    isExistVar(name: string): boolean{\r\n        if(!this.validVarName(name)){\r\n            return;\r\n        }\r\n        if(typeof(this.varMap[name]) == \"undefined\"){\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    validVarName(name): boolean{\r\n        if(typeof(name) != \"string\"){\r\n            cc.error(\"变量名必须为string类型\");\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    eval(left, operator, right){\r\n        if(this.isVar(left)){\r\n            left = VarManager.instance.getVar(left);\r\n        }\r\n        else if(typeof(left) == \"string\"){\r\n            left = this.getConstString(left);\r\n        }\r\n        if(this.isVar(right)){\r\n            right = VarManager.instance.getVar(right);\r\n        }\r\n        else if(typeof(right) == \"string\"){\r\n            right = this.getConstString(right);\r\n        }\r\n        if(typeof(left) != typeof(right)){\r\n            cc.error(\"类型不一致，左值：\" + typeof(left) + \"，右值：\" + typeof(right));\r\n            return;\r\n        }\r\n        switch(operator){\r\n            case \"==\":\r\n                return left === right;\r\n            case \">\":\r\n                return left > right;\r\n            case \">=\":\r\n                return left >= right;\r\n            case \"<\":\r\n                return left < right;\r\n            case \"<=\":\r\n                return left <= right;\r\n            case \"+\":\r\n                return left + right;\r\n            case \"-\":\r\n                return left - right;\r\n            case \"*\":\r\n                return left * right;\r\n            case \"/\":\r\n                return left / right;\r\n            case \"%\":\r\n                return left % right;\r\n            default:\r\n                cc.error(\"未知的运算符：\" + operator);\r\n                return false;\r\n        }\r\n    }\r\n\r\n    isVar(value): boolean{\r\n        if(typeof(value) != \"string\"){\r\n            return false;\r\n        }\r\n        if(value.charAt(0) == \"\\\"\" && value.charAt(value.length-1) == \"\\\"\"){\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    \r\n    getConstString(value): string{\r\n        if(typeof(value) != \"string\" || value.charAt(0) != \"\\\"\" || value.charAt(value.length-1) != \"\\\"\"){\r\n            cc.error(value + \"不是一个字符串常量\");\r\n            return null;\r\n        }\r\n        let result = value.substring(1);\r\n        result.substring(0, result.length - 1);\r\n        return result;\r\n    }\r\n    \r\n}"]}