{"version":3,"sources":["..\\..\\..\\..\\..\\assets\\Script\\parsers/assets\\Script\\parsers\\CommandParserManager.ts"],"names":[],"mappings":";;;;;AAAA,mEAA8D;AAC9D,wDAAmD;AAEnD,oBAAoB;AACpB,iFAAiF;AACjF,yFAAyF;AACzF,mBAAmB;AACnB,2FAA2F;AAC3F,mGAAmG;AACnG,8BAA8B;AAC9B,2FAA2F;AAC3F,mGAAmG;AAE7F,IAAA,kBAAmC,EAAlC,oBAAO,EAAE,sBAAQ,CAAkB;AAG1C;IAAkD,wCAAgB;IADlE;QAAA,qEA6CC;QAvCG,iBAAW,GAAc,EAAE,CAAC;QAK5B,oBAAc,GAA6B,EAAE,CAAC;;IAkClD,CAAC;6BA5CoB,oBAAoB;IAarC,qCAAM,GAAN;QAAA,iBAsBC;QArBG,sBAAoB,CAAC,QAAQ,GAAG,IAAI,CAAC;QACrC,IAAI,CAAC,cAAc,GAAG,IAAI,KAAK,EAA0B,CAAC;QAE1D,IAAI,CAAC,WAAW,CAAC,OAAO,CAAC,UAAA,IAAI;YACzB,IAAI,aAAa,GAAG,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;YACjD,IAAG,aAAa,IAAI,IAAI,EAAC;gBACrB,EAAE,CAAC,KAAK,CAAC,2CAA2C,CAAC,CAAC;gBACtD,OAAO;aACV;YACD,IAAG,CAAC,CAAC,aAAa,YAAY,gCAAsB,CAAC,EAAC;gBAClD,EAAE,CAAC,KAAK,CAAC,oCAAoC,GAAG,IAAI,CAAC,IAAI,CAAC,CAAC;gBAC3D,OAAO;aACV;YACD,aAAa,CAAC,gBAAgB,CAAC,OAAO,CAAC,UAAA,OAAO;gBAC1C,IAAG,OAAM,CAAC,KAAI,CAAC,cAAc,CAAC,OAAO,CAAC,CAAC,IAAI,WAAW,EAAC;oBACnD,EAAE,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,GAAG,4BAA4B,CAAC,CAAC;iBACtD;gBACD,KAAI,CAAC,cAAc,CAAC,OAAO,CAAC,GAAG,aAAa,CAAC;YACjD,CAAC,CAAC,CAAC;QAEP,CAAC,CAAC,CAAC;IACP,CAAC;IAED,oCAAK,GAAL,UAAO,WAAW;QACd,IAAG,OAAM,CAAC,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,IAAI,WAAW,EAAC;YAC/D,EAAE,CAAC,KAAK,CAAC,UAAU,GAAG,WAAW,CAAC,OAAO,GAAG,mBAAmB,CAAC,CAAC;YACjE,OAAO;SACV;QACD,IAAI,CAAC,cAAc,CAAC,WAAW,CAAC,OAAO,CAAC,CAAC,KAAK,CAAC,WAAW,CAAC,CAAC;IAChE,CAAC;;IAzCM,6BAAQ,GAA0B,IAAI,CAAC;IAG9C;QADC,QAAQ,CAAC,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC;6DACQ;IAK5B;QAHC,QAAQ,CAAC;YACN,OAAO,EAAE,KAAK;SACjB,CAAC;gEAC4C;IAV7B,oBAAoB;QADxC,OAAO;OACa,oBAAoB,CA4CxC;IAAD,2BAAC;CA5CD,AA4CC,CA5CiD,0BAAgB,GA4CjE;kBA5CoB,oBAAoB","file":"","sourceRoot":"..\\..\\..\\..\\..\\assets\\Script\\parsers","sourcesContent":["import CommandParserInterface from \"./CommandParserInterface\";\r\nimport ManagerInterface from \"../ManagerInterface\";\r\n\r\n// Learn TypeScript:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/typescript.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/typescript.html\r\n// Learn Attribute:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/reference/attributes.html\r\n// Learn life-cycle callbacks:\r\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\r\n//  - [English] http://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\r\n\r\nconst {ccclass, property} = cc._decorator;\r\n\r\n@ccclass\r\nexport default class CommandParserManager extends ManagerInterface {\r\n\r\n    static instance : CommandParserManager = null;\r\n\r\n    @property([cc.Node])\r\n    parserNodes: cc.Node[] = [];\r\n\r\n    @property({\r\n        visible: false,\r\n    })\r\n    commandParsers: CommandParserInterface[] = [];\r\n\r\n\r\n    onLoad () {\r\n        CommandParserManager.instance = this;\r\n        this.commandParsers = new Array<CommandParserInterface>();\r\n\r\n        this.parserNodes.forEach(node => {\r\n            let commandParser = node.getComponent(node.name);\r\n            if(commandParser == null){\r\n                cc.error(\"未找到和Node name对应的脚本，Parser脚本所在的Node必须与脚本同名\");\r\n                return;\r\n            }\r\n            if(!(commandParser instanceof CommandParserInterface)){\r\n                cc.error(\"Parser必须继承自CommandParserInterface：\" + node.name);\r\n                return;\r\n            }\r\n            commandParser.needParseCommand.forEach(element => {\r\n                if(typeof(this.commandParsers[element]) != \"undefined\"){\r\n                    cc.error(node.name + \"存在已被注册的Command，之前注册的内容将被覆盖\");\r\n                }\r\n                this.commandParsers[element] = commandParser;\r\n            });\r\n            \r\n        });\r\n    }\r\n\r\n    parse (jsonMessage){\r\n        if(typeof(this.commandParsers[jsonMessage.Command]) == \"undefined\"){\r\n            cc.error(\"无法识别的指令：\" + jsonMessage.Command + \"，需要有对应的Parser解析指令\");\r\n            return;\r\n        }\r\n        this.commandParsers[jsonMessage.Command].parse(jsonMessage);\r\n    }\r\n}\r\n"]}